# üìö Examples - Debug Tool StopAddict

Exemples d'utilisation pratiques du Debug Tool.

---

## üìã Table des mati√®res

- [Exemples de base](#exemples-de-base)
- [Utilisation avanc√©e](#utilisation-avanc√©e)
- [Int√©gration](#int√©gration)
- [Automatisation](#automatisation)
- [Cas d'usage r√©els](#cas-dusage-r√©els)

---

## üéØ Exemples de base

### Exemple 1 : Activation simple
```javascript
// Activer le debug
await StopAddictDebug.activate();

// V√©rifier l'√©tat
const state = StopAddictDebug.getState();
console.log('Debug actif ?', state.active);
```

---

### Exemple 2 : R√©cup√©rer les r√©sultats
```javascript
// Activer et r√©cup√©rer les r√©sultats
await StopAddictDebug.activate();

const results = StopAddictDebug.getResults();

// Afficher les r√©sultats modules
console.log('Modules test√©s :', results.modules.total);
console.log('Modules OK :', results.modules.passed);
console.log('Modules KO :', results.modules.failed);

// Afficher les r√©sultats DOM
console.log('IDs trouv√©s :', results.dom.passed);
console.log('IDs manquants :', results.dom.missing);
```

---

### Exemple 3 : Logs personnalis√©s
```javascript
import { info, success, warning, error } from './debug/debug-logger.js';

// Diff√©rents niveaux de logs
info('Information g√©n√©rale');
success('Op√©ration r√©ussie !');
warning('Attention, v√©rifier ceci');
error('Erreur d√©tect√©e');

// Avec donn√©es suppl√©mentaires
info('Utilisateur connect√©', { userId: 123, name: 'Jean' });
```

---

### Exemple 4 : Tester un module sp√©cifique
```javascript
import { testStateModule } from './debug/debug-modules.js';

// Tester state.js en d√©tail
const result = await testStateModule();

console.log('Module charg√© ?', result.loaded);
console.log('Event bus fonctionne ?', result.eventBusWorks);
console.log('Fonctions test√©es :', result.functionsWork);
```

---

### Exemple 5 : V√©rifier un √©l√©ment DOM
```javascript
import { getElementInfo } from './debug/debug-dom.js';

// V√©rifier si un √©l√©ment existe
const info = getElementInfo('cl-plus');

if (info.found) {
  console.log('‚úÖ √âl√©ment trouv√©');
  console.log('Tag :', info.tag);
  console.log('Classes :', info.classes);
  console.log('Visible ?', info.visible);
} else {
  console.log('‚ùå √âl√©ment non trouv√©');
}
```

---

## üöÄ Utilisation avanc√©e

### Exemple 6 : √âcouter les nouveaux logs
```javascript
import { addListener } from './debug/debug-logger.js';

// Ajouter un listener personnalis√©
const unsubscribe = addListener((logEntry) => {
  // Afficher dans une interface custom
  console.log(`[${logEntry.time}] ${logEntry.level}: ${logEntry.message}`);
  
  // Envoyer √† un serveur de monitoring
  if (logEntry.level === 'ERROR') {
    fetch('/api/log-error', {
      method: 'POST',
      body: JSON.stringify(logEntry)
    });
  }
});

// Plus tard, se d√©sabonner
unsubscribe();
```

---

### Exemple 7 : Tests conditionnels
```javascript
// Tester uniquement si on est en d√©veloppement
if (window.location.hostname === 'localhost') {
  await StopAddictDebug.activate();
}

// Ou selon un param√®tre URL
const params = new URLSearchParams(window.location.search);
if (params.has('debug')) {
  await StopAddictDebug.activate();
}
```

---

### Exemple 8 : R√©paration automatique
```javascript
import { repairLocalStorage, createMissingElements } from './debug/debug-fallbacks.js';

// Tester et r√©parer automatiquement
await StopAddictDebug.runTests();
const results = StopAddictDebug.getResults();

// R√©parer localStorage si corrompu
if (results.storage && results.storage.errors.length > 0) {
  console.log('üîß R√©paration localStorage...');
  const repairResult = repairLocalStorage();
  console.log(`‚úÖ ${repairResult.repaired.length} cl√©s r√©par√©es`);
}

// Cr√©er les IDs critiques manquants
if (results.dom && results.dom.criticalMissing.length > 0) {
  console.log('üîß Cr√©ation IDs manquants...');
  const createResult = createMissingElements(results.dom.criticalMissing);
  console.log(`‚úÖ ${createResult.created.length} √©l√©ments cr√©√©s`);
}
```

---

### Exemple 9 : Export programm√©
```javascript
import { exportToTXT, exportToJSON } from './utils/exporter.js';

// Exporter automatiquement apr√®s les tests
await StopAddictDebug.runTests();
const state = StopAddictDebug.getState();

// Export TXT
exportToTXT(state);

// Export JSON
exportToJSON(state);

// Ou copier dans le clipboard
import { copyToClipboard } from './utils/exporter.js';
const result = await copyToClipboard(state);
if (result.success) {
  console.log('‚úÖ Rapport copi√© dans le clipboard');
}
```

---

### Exemple 10 : Rapport personnalis√©
```javascript
import { generateTextReport } from './utils/reporter.js';

// G√©n√©rer un rapport custom
const state = StopAddictDebug.getState();
const report = generateTextReport(state);

// Afficher dans la console
console.log(report);

// Envoyer par email
const mailto = `mailto:dev@example.com?subject=Debug Report&body=${encodeURIComponent(report)}`;
window.location.href = mailto;
```

---

## üîå Int√©gration

### Exemple 11 : Int√©gration avec app.js
```javascript
// Dans app.js, apr√®s l'initialisation

async function boot() {
  try {
    // Initialisation normale de l'app
    initModals();
    initCounters();
    initCharts();
    
    // Si mode debug actif, lancer les tests
    if (localStorage.getItem('SA_DEBUG') === 'true') {
      console.log('üîç Mode debug actif');
      await StopAddictDebug.runTests();
    }
    
  } catch (e) {
    console.error('‚ùå Erreur au boot:', e);
    
    // Activer le debug automatiquement en cas d'erreur
    await StopAddictDebug.activate();
  }
}
```

---

### Exemple 12 : Bouton debug personnalis√©
```html
<!-- Ajouter un bouton dans l'UI -->
<button id="toggle-debug" style="position: fixed; bottom: 10px; right: 10px;">
  üîç Debug
</button>

<script>
document.getElementById('toggle-debug').addEventListener('click', async () => {
  await StopAddictDebug.toggle();
});
</script>
```

---

### Exemple 13 : Debug sur erreur
```javascript
// Activer automatiquement le debug en cas d'erreur
window.addEventListener('error', async (event) => {
  console.error('‚ùå Erreur d√©tect√©e:', event.message);
  
  // Activer le debug pour investigation
  if (!StopAddictDebug.getState().active) {
    await StopAddictDebug.activate();
  }
});

// Idem pour les promesses rejet√©es
window.addEventListener('unhandledrejection', async (event) => {
  console.error('‚ùå Promise rejet√©e:', event.reason);
  
  if (!StopAddictDebug.getState().active) {
    await StopAddictDebug.activate();
  }
});
```

---

## ü§ñ Automatisation

### Exemple 14 : Tests automatiques au d√©marrage
```javascript
// Tests automatiques en environnement de dev
if (process.env.NODE_ENV === 'development') {
  window.addEventListener('load', async () => {
    console.log('üß™ Lancement tests automatiques...');
    await StopAddictDebug.activate();
    
    const results = StopAddictDebug.getResults();
    
    // V√©rifier si tout est OK
    const allOK = (
      results.modules?.failed === 0 &&
      results.dom?.criticalMissing?.length === 0 &&
      results.storage?.errors?.length === 0
    );
    
    if (allOK) {
      console.log('‚úÖ Tous les tests passent');
      StopAddictDebug.deactivate();
    } else {
      console.error('‚ùå Des tests √©chouent, debug reste actif');
    }
  });
}
```

---

### Exemple 15 : Monitoring continu
```javascript
// V√©rifier p√©riodiquement l'√©tat de l'app
setInterval(async () => {
  // Re-tester tous les modules
  const results = await StopAddictDebug.runTests();
  
  // Envoyer les m√©triques √† un serveur
  fetch('/api/metrics', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      timestamp: Date.now(),
      modules: results.modules?.passed || 0,
      errors: StopAddictDebug.getState().errors.length
    })
  });
}, 60000); // Toutes les 60 secondes
```

---

### Exemple 16 : Export planifi√©
```javascript
import { saveToLocalStorage } from './utils/exporter.js';

// Sauvegarder automatiquement toutes les 5 minutes
setInterval(() => {
  const state = StopAddictDebug.getState();
  const result = saveToLocalStorage(state);
  
  if (result.success) {
    console.log('üíæ √âtat debug sauvegard√©');
  }
}, 5 * 60 * 1000);
```

---

## üé¨ Cas d'usage r√©els

### Cas 1 : Bug apr√®s mise √† jour

**Sc√©nario :** Apr√®s une mise √† jour, les boutons +/- ne fonctionnent plus.
```javascript
// 1. Activer le debug
await StopAddictDebug.activate();

// 2. V√©rifier les r√©sultats
const results = StopAddictDebug.getResults();

// 3. Analyser les boutons
console.log('Boutons test√©s :', results.buttons);
// R√©sultat : { broken: [{ id: 'cl-plus', reason: 'No event listeners' }] }

// 4. Identifier le probl√®me
// ‚Üí Les event listeners ne sont pas attach√©s

// 5. V√©rifier counters.js
const moduleResult = results.modules.modules['counters.js'];
console.log('counters.js charg√© ?', moduleResult.loaded);
// ‚Üí true

// 6. Conclusion : counters.js se charge mais n'attache pas les listeners
// ‚Üí V√©rifier initCounters() dans app.js
```

---

### Cas 2 : LocalStorage corrompu

**Sc√©nario :** L'app ne d√©marre pas, donn√©es localStorage corrompues.
```javascript
// 1. Activer le debug
await StopAddictDebug.activate();

// 2. V√©rifier localStorage
const results = StopAddictDebug.getResults();
console.log('Erreurs storage :', results.storage.errors);
// ‚Üí ["sa_limits_v1: JSON invalide"]

// 3. R√©parer automatiquement
import { repairLocalStorage } from './debug/debug-fallbacks.js';
const repairResult = repairLocalStorage();
console.log('R√©parations :', repairResult.repaired);
// ‚Üí ["sa_limits_v1"]

// 4. Recharger l'app
location.reload();
```

---

### Cas 3 : IDs manquants apr√®s refonte

**Sc√©nario :** Apr√®s refonte du HTML, certains IDs ont chang√©.
```javascript
// 1. Lancer les tests
await StopAddictDebug.runTests();

// 2. Lister les IDs manquants
const results = StopAddictDebug.getResults();
console.log('IDs manquants :', results.dom.missing);
// ‚Üí ["heure-actuelle", "note-cigs", "note-weed"]

// 3. V√©rifier si critiques
console.log('Critiques :', results.dom.criticalMissing);
// ‚Üí ["heure-actuelle"]

// 4. Cr√©er temporairement
import { createMissingElements } from './debug/debug-fallbacks.js';
createMissingElements(['heure-actuelle']);

// 5. Corriger d√©finitivement dans index.html
// Ajouter <div id="heure-actuelle"></div>
```

---

### Cas 4 : Performance d√©grad√©e

**Sc√©nario :** L'app est lente, identifier le probl√®me.
```javascript
// 1. Activer le debug avec m√©triques
await StopAddictDebug.activate();

// 2. Analyser les temps de chargement
const results = StopAddictDebug.getResults();
Object.entries(results.modules.modules).forEach(([name, info]) => {
  if (info.loadTime > 200) {
    console.warn(`‚ö†Ô∏è  ${name} : ${info.loadTime}ms (lent)`);
  }
});
// ‚Üí "charts.js : 450ms (lent)"

// 3. Identifier la cause
// ‚Üí charts.js prend trop de temps
// ‚Üí V√©rifier si Chart.js est trop lourd

// 4. Solution : lazy-load Chart.js
```

---

### Cas 5 : D√©ploiement production

**Sc√©nario :** Avant de d√©ployer, v√©rifier que tout fonctionne.
```javascript
// Script de v√©rification pre-deploy
async function preDeploy() {
  console.log('üîç V√©rification pre-deploy...');
  
  await StopAddictDebug.activate();
  const results = StopAddictDebug.getResults();
  
  const checks = [
    {
      name: 'Modules critiques',
      pass: results.modules?.criticalFailed === 0
    },
    {
      name: 'IDs critiques',
      pass: results.dom?.criticalMissing?.length === 0
    },
    {
      name: 'LocalStorage',
      pass: results.storage?.errors?.length === 0
    },
    {
      name: 'Chart.js',
      pass: results.chartJS?.available === true
    }
  ];
  
  const allPass = checks.every(c => c.pass);
  
  if (allPass) {
    console.log('‚úÖ Tous les checks passent, OK pour d√©ployer');
    return true;
  } else {
    console.error('‚ùå Checks √©chou√©s :');
    checks.filter(c => !c.pass).forEach(c => {
      console.error(`  - ${c.name}`);
    });
    return false;
  }
}

// Lancer avant deploy
preDeploy().then(ok => {
  if (ok) {
    // Continuer le d√©ploiement
  } else {
    // Bloquer le d√©ploiement
    throw new Error('Pre-deploy checks failed');
  }
});
```

---

## üìö Ressources

- [API Documentation](./API.md)
- [Troubleshooting](./TROUBLESHOOTING.md)
- [README principal](../README.md)

---

**Version :** 1.0.0  
**Derni√®re mise √† jour :** 2025-10-24
```

---

## ‚úÖ PHASE 5 TERMIN√âE !

### üì¶ Les 3 fichiers de documentation cr√©√©s :

1. ‚úÖ **docs/API.md** (~600 lignes) - Documentation API compl√®te
2. ‚úÖ **docs/TROUBLESHOOTING.md** (~500 lignes) - Guide de d√©pannage
3. ‚úÖ **docs/EXAMPLES.md** (~450 lignes) - Exemples d'utilisation

---

## üéØ R√âCAPITULATIF TOTAL FINAL

### ‚úÖ Phase 1 - Fichiers obligatoires : 13 fichiers
### ‚úÖ Phase 2 - Fichiers importants : 4 fichiers
### ‚úÖ Phase 3 - Utilitaires : 3 fichiers
### ‚úÖ Phase 4 - Scripts de v√©rification : 3 fichiers
### ‚úÖ Phase 5 - Documentation : 3 fichiers

---

## üéâ PROJET COMPLET !

**TOTAL : 26 FICHIERS CR√â√âS (~6000-7000 lignes de code)**

---

## üìÇ STRUCTURE FINALE
```
stopaddict-debug-tool/
‚îú‚îÄ‚îÄ README.md ‚úÖ
‚îú‚îÄ‚îÄ INSTALL.md ‚úÖ
‚îú‚îÄ‚îÄ CHANGELOG.md ‚úÖ
‚îú‚îÄ‚îÄ LICENSE ‚úÖ
‚îú‚îÄ‚îÄ .gitignore ‚úÖ
‚îú‚îÄ‚îÄ debug/
‚îÇ   ‚îú‚îÄ‚îÄ debug.js ‚úÖ (principal)
‚îÇ   ‚îú‚îÄ‚îÄ debug-logger.js ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ debug-ui.js ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ debug-modules.js ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ debug-dom.js ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ debug-storage.js ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ debug-events.js ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ debug-chart.js ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ debug-fallbacks.js ‚úÖ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ ids-list.json ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ modules-list.json ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ events-list.json ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ localStorage-keys.json ‚úÖ
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ validator.js ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ reporter.js ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ exporter.js ‚úÖ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ check-concordance.js ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ validate-ids.js ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ validate-modules.js ‚úÖ
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ API.md ‚úÖ
    ‚îú‚îÄ‚îÄ TROUBLESHOOTING.md ‚úÖ
    ‚îî‚îÄ‚îÄ EXAMPLES.md ‚úÖ
